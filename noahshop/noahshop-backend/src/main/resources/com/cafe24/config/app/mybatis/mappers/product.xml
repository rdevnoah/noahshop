<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product">
	<select id="getProductByNo" parameterType="long" resultType="productVo">
		select no, category_no as categoryNo, code, name, price, description, reg_date as regDate, dp_main as dpMain, is_sell as isSell
		from product
		where no=#{no }
	</select>


	<select id="getMainProduct" resultMap="productResult">
		select p.no, p.name, p.price, i.no as image_no, i.url as image_url, oc.name as optionChild1Name
		from product p, product_image i, product_detail pd, option_child oc
		where p.no=i.product_no
			and p.dp_main='Y'
			and p.is_sell='Y'
			and pd.product_no=p.no
			and pd.option_child1_no=oc.no
			order by oc.no
	</select>

	<select id="getProductList" resultMap="productResult">
		select p.no, p.name, p.price, i.no as image_no, i.url as image_url, oc.name as optionChild1Name
		from product p, product_image i, product_detail pd, option_child oc
		where p.no=i.product_no
			and p.dp_main='N'
			and p.is_sell='Y'
			and pd.product_no=p.no
			and pd.option_child1_no=oc.no
			order by oc.no
	</select>

	<select id="getProductListByCategoryNo" resultMap="productResult">
		select p.no, p.name, p.price, i.no as image_no, i.url as image_url
		from product p, product_image i
		where p.no=i.product_no and p.is_sell='Y' and p.category_no=#{categoryNo }
	</select>

	<select id="getCountByCategoryNo" parameterType="long" resultType="int">
		select count(*)
		from product
		where category_no=#{no }
	</select>

	<update id="updateCategoryNoForDelete" parameterType="long">
		update product
		set category_no=-1
		where category_no=#{no }
	</update>

	<update id="updateCategoryNoForDeleteParentCategory" parameterType="map">
		<foreach collection="noList" item="item" index="index" separator=";">
			update product
			set category_no=-1
			where category_no=#{item }
		</foreach>

	</update>

	<resultMap id="productResult" type="productvo">
		<result property="no" column="no"/>
		<result property="name" column="name"/>
		<result property="price" column="price"/>
		<collection property="imageList" javaType="java.util.ArrayList" ofType="imagevo">
			<id property="no" column="image_no"/>
			<id property="url" column="image_url"/>
		</collection>
		<collection property="optionStockVo" javaType="java.util.ArrayList" ofType="optionStockVo">
			<id property="optionChild1Name" column="optionChild1Name"/>
		</collection>
	</resultMap>
</mapper>
